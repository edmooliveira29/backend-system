name: api-backend
on:
  push:
    branches: [ main ]

jobs:

  deploy:
    runs-on: ubuntu-latest      
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
  
      - name: Authenticate with Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: '${{ secrets.ACCOUNT_KEY_JSON_GOOGLE }}'
          export_default_credentials: true
  
      - name: SSH into Compute Engine
        run: |
          mkdir -p ~/.ssh/
          echo "${{secrets.ACCESS_GITHUB_INSTANCE}}"
          echo "${{secrets.ACCESS_GITHUB_INSTANCE}}" > ~/.ssh/id_rsa
          cat ~/.ssh/id_rsa
          gcloud compute ssh ${{ secrets.NAME_INSTANCE_GOOGLE }} --zone ${{ secrets.ZONE_INSTANCE_GOOGLE }} --project ${{secrets.PROJECT_ID_GOOGLE}} --ssh-key-file ~/.ssh/id_rsa --quiet --tunnel-through-iap --command "echo Hello world"


