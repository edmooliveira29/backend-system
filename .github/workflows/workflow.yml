name: api-backend
on:
  push:
    branches: [ main ]

jobs:

  deploy:
    runs-on: ubuntu-latest      
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
  
      - name: Authenticate with Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: '${{ secrets.ACCOUNT_KEY_JSON_GOOGLE }}'
          export_default_credentials: true
  
      - name: SSH into Compute Engine
        run: |
          mkdir -p ~/.ssh/
          echo -n "${{ secrets.ACCESS_GITHUB_INSTANCE }}" > ~/.ssh/google_compute_engine
          chmod 600 ~/.ssh/google_compute_engine  # Garanta as permiss√µes corretas para a chave privada
          gcloud compute ssh ${{secrets.USER_INSTANCE_GOOGLE}}@${{ secrets.NAME_INSTANCE_GOOGLE }} --project=${{ secrets.PROJECT_ID_GOOGLE }} --zone=${{ secrets.ZONE_INSTANCE_GOOGLE }} --ssh-key-file=~/.ssh/google_compute_engine --quiet --tunnel-through-iap --command "echo Hello world"
