name: api-backend
on:
  push:
    branches: [ main ]

jobs:

  deploy:
    runs-on: ubuntu-latest      
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
  
      - name: Authenticate with Google Cloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: '${{ secrets.ACCOUNT_KEY_JSON_GOOGLE }}'
          export_default_credentials: true
  
      - name: SSH into Compute Engine
        run: |
          gcloud compute ssh INSTANCE_NAME --zone ZONE --project PROJECT_ID --ssh-key-file /tmp/KEY_FILE --quiet --tunnel-through-iap --command "echo Hello world"
        env:
          INSTANCE_NAME: ${{ secrets.NAME_INSTANCE_GOOGLE }}
          ZONE: ${{ secrets.ZONE_INSTANCE_GOOGLE }}
          PROJECT_ID: ${{secrets.PROJECT_ID_GOOGLE}}
          KEY_FILE: /tmp/google_compute_engine

